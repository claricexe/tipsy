<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tipsy - try nail designs on your hands</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Italiana&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --olive: #9CA986;
            --apricot: #F7C6A8;
            --mauve: #B08B96;
            --linen: #FFF8F0;
            --white: #FFFFFF;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--linen);
            color: var(--mauve);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: var(--olive);
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(156, 169, 134, 0.1);
        }

        .logo {
            font-family: 'Italiana', serif;
            font-size: 2em;
            color: var(--white);
            text-align: center;
            letter-spacing: 2px;
        }

        .main-content {
            padding: 40px 20px;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome {
            text-align: center;
            max-width: 600px;
            margin: 60px auto;
        }

        .welcome h1 {
            font-family: 'Italiana', serif;
            font-size: 3em;
            color: var(--olive);
            margin-bottom: 20px;
            font-weight: 400;
        }

        .welcome p {
            font-size: 1.2em;
            font-weight: 300;
            margin-bottom: 40px;
            color: var(--mauve);
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .button {
            background: var(--olive);
            color: var(--white);
            border: none;
            padding: 18px 40px;
            border-radius: 15px;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(156, 169, 134, 0.2);
        }

        .button:hover {
            background: #8a9778;
            transform: translateY(-2px);
        }

        .button-secondary {
            background: var(--apricot);
        }

        .button-outline {
            background: transparent;
            border: 2px solid var(--olive);
            color: var(--olive);
            box-shadow: none;
        }

        .button-outline:hover {
            background: var(--olive);
            color: var(--white);
        }

        .upload-area {
            background: var(--white);
            border: 3px dashed var(--olive);
            border-radius: 20px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
        }

        .upload-area:hover {
            border-color: var(--apricot);
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .upload-area h2 {
            font-family: 'Italiana', serif;
            color: var(--olive);
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 400;
        }

        input[type="file"] {
            display: none;
        }

        .preview-container {
            background: var(--white);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(156, 169, 134, 0.08);
        }

        .image-preview {
            max-width: 600px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
        }

        .image-preview img {
            width: 100%;
            height: auto;
            display: block;
        }

        .section-title {
            font-family: 'Italiana', serif;
            color: var(--olive);
            font-size: 2em;
            margin-bottom: 20px;
            font-weight: 400;
            text-align: center;
        }

        .instruction-box {
            background: rgba(156, 169, 134, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .extraction-canvas-container {
            text-align: center;
            margin: 20px 0;
        }

        #extractionCanvas {
            max-width: 100%;
            border: 3px solid var(--olive);
            border-radius: 15px;
            cursor: crosshair;
        }

        .extracted-previews {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .extracted-item {
            text-align: center;
        }

        .extracted-item canvas {
            border: 3px solid var(--olive);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(156, 169, 134, 0.15);
            display: block;
            margin-bottom: 10px;
        }

        .nail-slots {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .nail-slot {
            width: 100px;
            height: 140px;
            background: var(--white);
            border: 3px dashed var(--mauve);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .nail-slot.drag-over {
            border-color: var(--olive);
            background: rgba(156, 169, 134, 0.1);
            transform: scale(1.05);
        }

        .nail-slot.filled {
            border-style: solid;
            border-color: var(--olive);
        }

        .nail-slot-preview {
            width: 70px;
            height: 100px;
            border-radius: 35px;
            background-size: cover;
            background-position: center;
        }

        .nail-slot-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--mauve);
            margin-top: 8px;
        }

        .clear-nail {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--mauve);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
            display: none;
        }

        .nail-slot.filled .clear-nail {
            display: block;
        }

        .design-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .design-card {
            background: var(--white);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: move;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(156, 169, 134, 0.08);
            position: relative;
        }

        .design-card:hover {
            transform: translateY(-5px);
        }

        .design-card.dragging {
            opacity: 0.5;
        }

        .design-preview {
            width: 70px;
            height: 100px;
            border-radius: 35px;
            margin: 0 auto 10px;
            border: 2px solid var(--linen);
            background-size: cover;
            background-position: center;
        }

        .design-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--olive);
        }

        .delete-design {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--mauve);
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            cursor: pointer;
            font-size: 14px;
            display: none;
        }

        .design-card:hover .delete-design {
            display: block;
        }

        .tips {
            background: rgba(247, 198, 168, 0.1);
            border-left: 4px solid var(--apricot);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .tips h3 {
            font-family: 'Poppins', sans-serif;
            color: var(--olive);
            font-weight: 500;
            margin-bottom: 10px;
        }

        .tips ul {
            list-style: none;
            padding: 0;
        }

        .tips li {
            padding: 5px 0;
            font-weight: 300;
        }

        .tips li:before {
            content: "✨ ";
            margin-right: 8px;
        }

        .success-banner {
            background: var(--apricot);
            color: var(--white);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .library-section {
            margin: 30px 0;
        }

        .library-section h3 {
            font-family: 'Poppins', sans-serif;
            color: var(--olive);
            font-weight: 500;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .welcome h1 {
                font-size: 2em;
            }

            .nail-slots {
                gap: 8px;
            }

            .nail-slot {
                width: 80px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">tipsy</div>
        </div>
    </header>

    <div class="container main-content">
        
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="screen active">
            <div class="welcome">
                <h1>try before you apply</h1>
                <p>extract nail designs from photos and create your perfect look</p>
                
                <div class="button-group">
                    <button class="button" onclick="goToUploadHand()">
                        📸 upload my hand
                    </button>
                    <button class="button button-secondary" onclick="goToExtract()">
                        🎨 extract nail designs
                    </button>
                    <button class="button button-outline" onclick="goToLibrary()">
                        💾 my library (<span id="libraryCount">0</span>)
                    </button>
                </div>

                <div class="tips">
                    <h3>how it works:</h3>
                    <ul>
                        <li>upload nail art photos and select individual nails</li>
                        <li>save designs to your personal library</li>
                        <li>mix and match designs from different sources</li>
                        <li>drag designs onto your hand to preview</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Extract Inspiration Screen -->
        <div id="extractScreen" class="screen">
            <h2 class="section-title">extract nail designs</h2>
            
            <div class="upload-area" onclick="document.getElementById('inspoInput').click()">
                <div class="upload-icon">🎨</div>
                <h2>upload nail art photo</h2>
                <p>from pinterest, instagram, or anywhere!</p>
                <input type="file" id="inspoInput" accept="image/*">
            </div>

            <div id="extractionArea" style="display: none;">
                <div class="preview-container">
                    <div class="instruction-box">
                        <p><strong>Click and drag</strong> to select each nail you want to save</p>
                    </div>
                    <div class="extraction-canvas-container">
                        <canvas id="extractionCanvas"></canvas>
                    </div>
                </div>

                <div id="extractedPreviews" class="preview-container" style="display: none;">
                    <h3 style="text-align: center; color: var(--olive); margin-bottom: 20px;">extracted designs</h3>
                    <div class="extracted-previews" id="previewsContainer"></div>
                </div>
            </div>

            <div class="button-group">
                <button class="button button-outline" onclick="showScreen('welcomeScreen')">
                    ← back
                </button>
            </div>
        </div>

        <!-- Library Screen -->
        <div id="libraryScreen" class="screen">
            <h2 class="section-title">my design library</h2>
            
            <div class="preview-container">
                <div class="library-section">
                    <h3>✨ saved designs (<span id="savedCount">0</span>)</h3>
                    <div class="design-grid" id="savedGrid"></div>
                </div>

                <div class="library-section">
                    <h3>🎨 classic colors</h3>
                    <div class="design-grid" id="classicGrid"></div>
                </div>
            </div>

            <div class="button-group">
                <button class="button button-outline" onclick="showScreen('welcomeScreen')">
                    ← home
                </button>
                <button class="button button-secondary" onclick="goToExtract()">
                    + extract more designs
                </button>
                <button class="button" onclick="goToUploadHand()">
                    build my look →
                </button>
            </div>
        </div>

        <!-- Upload Hand Screen -->
        <div id="uploadHandScreen" class="screen">
            <h2 class="section-title">upload your hand</h2>
            
            <div class="upload-area" onclick="document.getElementById('handInput').click()">
                <div class="upload-icon">📸</div>
                <h2>upload hand photo</h2>
                <p>spread fingers, use good lighting</p>
                <input type="file" id="handInput" accept="image/*">
            </div>

            <div class="button-group">
                <button class="button button-outline" onclick="showScreen('welcomeScreen')">
                    ← back
                </button>
            </div>
        </div>

        <!-- Editor Screen -->
        <div id="editorScreen" class="screen">
            <div class="preview-container">
                <h2 class="section-title">your hand</h2>
                <div class="image-preview" id="handPreview"></div>
            </div>

            <div class="preview-container">
                <h2 class="section-title">drag designs to your nails</h2>
                
                <div class="instruction-box">
                    <p>👇 drag any design from below onto each nail above</p>
                </div>

                <div class="nail-slots">
                    <div class="nail-slot" data-finger="thumb">
                        <div class="nail-slot-preview" id="thumb-preview"></div>
                        <button class="clear-nail" onclick="clearNail('thumb')">×</button>
                        <div class="nail-slot-label">thumb</div>
                    </div>
                    <div class="nail-slot" data-finger="index">
                        <div class="nail-slot-preview" id="index-preview"></div>
                        <button class="clear-nail" onclick="clearNail('index')">×</button>
                        <div class="nail-slot-label">index</div>
                    </div>
                    <div class="nail-slot" data-finger="middle">
                        <div class="nail-slot-preview" id="middle-preview"></div>
                        <button class="clear-nail" onclick="clearNail('middle')">×</button>
                        <div class="nail-slot-label">middle</div>
                    </div>
                    <div class="nail-slot" data-finger="ring">
                        <div class="nail-slot-preview" id="ring-preview"></div>
                        <button class="clear-nail" onclick="clearNail('ring')">×</button>
                        <div class="nail-slot-label">ring</div>
                    </div>
                    <div class="nail-slot" data-finger="pinky">
                        <div class="nail-slot-preview" id="pinky-preview"></div>
                        <button class="clear-nail" onclick="clearNail('pinky')">×</button>
                        <div class="nail-slot-label">pinky</div>
                    </div>
                </div>

                <div class="library-section">
                    <h3>✨ my saved designs</h3>
                    <div class="design-grid" id="editorSavedGrid"></div>
                </div>

                <div class="library-section">
                    <h3>🎨 classic colors</h3>
                    <div class="design-grid" id="editorClassicGrid"></div>
                </div>
            </div>

            <div class="button-group">
                <button class="button button-outline" onclick="showScreen('welcomeScreen')">
                    ← start over
                </button>
                <button class="button button-secondary" onclick="applyDesigns()">
                    apply to my hand →
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="resultScreen" class="screen">
            <div class="preview-container">
                <h2 class="section-title">your design</h2>
                <div class="image-preview" id="resultPreview"></div>
            </div>

            <div class="button-group">
                <button class="button button-outline" onclick="showScreen('editorScreen')">
                    ← try different designs
                </button>
                <button class="button" onclick="saveResult()">
                    💾 save image
                </button>
                <button class="button button-secondary" onclick="shareResult()">
                    📤 share
                </button>
            </div>

            <div class="tips">
                <h3>love your nails?</h3>
                <ul>
                    <li>save and show your nail tech</li>
                    <li>share on social media</li>
                    <li>start over to try more looks</li>
                </ul>
            </div>
        </div>

    </div>

    <script>
        // State
        let savedDesigns = JSON.parse(localStorage.getItem('tipsySaved') || '[]');
        let currentHandImage = null;
        let nailDesigns = { thumb: null, index: null, middle: null, ring: null, pinky: null };
        
        const classicColors = [
            { id: 'red', name: 'red', color: '#DC143C', type: 'color' },
            { id: 'pink', name: 'pink', color: '#FFB6C1', type: 'color' },
            { id: 'nude', name: 'nude', color: '#E8C4B8', type: 'color' },
            { id: 'black', name: 'black', color: '#2C2C2C', type: 'color' },
            { id: 'blue', name: 'blue', color: '#4682B4', type: 'color' },
            { id: 'purple', name: 'purple', color: '#E6E6FA', type: 'color' },
            { id: 'green', name: 'green', color: '#98FF98', type: 'color' },
            { id: 'gold', name: 'gold', color: '#FFD700', type: 'color' },
        ];

        // Extraction variables
        let extractCanvas, extractCtx, extractImg;
        let isDrawing = false;
        let startX, startY;

        // Initialize
        updateCounts();

        // Navigation
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function goToExtract() {
            showScreen('extractScreen');
        }

        function goToLibrary() {
            populateLibrary();
            showScreen('libraryScreen');
        }

        function goToUploadHand() {
            showScreen('uploadHandScreen');
        }

        function updateCounts() {
            document.getElementById('libraryCount').textContent = savedDesigns.length;
            document.getElementById('savedCount').textContent = savedDesigns.length;
        }

        // File uploads
        document.getElementById('inspoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    setupExtraction(event.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('handInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    currentHandImage = event.target.result;
                    document.getElementById('handPreview').innerHTML = `<img src="${currentHandImage}">`;
                    populateEditor();
                    showScreen('editorScreen');
                };
                reader.readAsDataURL(file);
            }
        });

        // Setup extraction canvas
        function setupExtraction(imgSrc) {
            document.getElementById('extractionArea').style.display = 'block';
            
            extractImg = new Image();
            extractImg.onload = function() {
                extractCanvas = document.getElementById('extractionCanvas');
                extractCtx = extractCanvas.getContext('2d');
                
                const maxW = Math.min(600, window.innerWidth - 80);
                const scale = maxW / extractImg.width;
                extractCanvas.width = extractImg.width * scale;
                extractCanvas.height = extractImg.height * scale;
                
                extractCtx.drawImage(extractImg, 0, 0, extractCanvas.width, extractCanvas.height);
                
                extractCanvas.onmousedown = startDraw;
                extractCanvas.onmousemove = draw;
                extractCanvas.onmouseup = endDraw;
            };
            extractImg.src = imgSrc;
        }

        function startDraw(e) {
            const rect = extractCanvas.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
            isDrawing = true;
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = extractCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            extractCtx.clearRect(0, 0, extractCanvas.width, extractCanvas.height);
            extractCtx.drawImage(extractImg, 0, 0, extractCanvas.width, extractCanvas.height);
            
            extractCtx.strokeStyle = '#9CA986';
            extractCtx.lineWidth = 3;
            extractCtx.strokeRect(startX, startY, x - startX, y - startY);
        }

        function endDraw(e) {
            if (!isDrawing) return;
            isDrawing = false;
            
            const rect = extractCanvas.getBoundingClientRect();
            const endX = e.clientX - rect.left;
            const endY = e.clientY - rect.top;
            
            const w = Math.abs(endX - startX);
            const h = Math.abs(endY - startY);
            
            if (w > 30 && h > 30) {
                extractNail(Math.min(startX, endX), Math.min(startY, endY), w, h);
            }
        }

        function extractNail(x, y, w, h) {
            const scale = extractImg.width / extractCanvas.width;
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            
            tempCanvas.width = w * scale;
            tempCanvas.height = h * scale;
            
            tempCtx.drawImage(extractImg, x * scale, y * scale, w * scale, h * scale, 0, 0, tempCanvas.width, tempCanvas.height);
            
            const dataUrl = tempCanvas.toDataURL();
            showExtracted(dataUrl);
        }

        function showExtracted(dataUrl) {
            document.getElementById('extractedPreviews').style.display = 'block';
            const container = document.getElementById('previewsContainer');
            
            const div = document.createElement('div');
            div.className = 'extracted-item';
            div.innerHTML = `
                <canvas width="70" height="100"></canvas>
                <button class="button" style="padding: 8px 16px; font-size: 14px;" onclick='saveDesign("${dataUrl}")'>
                    💾 save
                </button>
            `;
            
            const canvas = div.querySelector('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = () => ctx.drawImage(img, 0, 0, 70, 100);
            img.src = dataUrl;
            
            container.appendChild(div);
        }

        function saveDesign(dataUrl) {
            const design = {
                id: 'saved-' + Date.now(),
                name: 'design ' + (savedDesigns.length + 1),
                imageData: dataUrl,
                type: 'extracted'
            };
            
            savedDesigns.push(design);
            localStorage.setItem('tipsySaved', JSON.stringify(savedDesigns));
            updateCounts();
            showBanner('✨ saved to library!');
        }

        function populateLibrary() {
            const savedGrid = document.getElementById('savedGrid');
            const classicGrid = document.getElementById('classicGrid');
            
            if (savedDesigns.length === 0) {
                savedGrid.innerHTML = '<p style="text-align:center;padding:20px;color:var(--mauve)">no designs yet - extract some!</p>';
            } else {
                savedGrid.innerHTML = savedDesigns.map(d => makeCard(d, true)).join('');
            }
            
            classicGrid.innerHTML = classicColors.map(d => makeCard(d, false)).join('');
        }

        function populateEditor() {
            const savedGrid = document.getElementById('editorSavedGrid');
            const classicGrid = document.getElementById('editorClassicGrid');
            
            if (savedDesigns.length === 0) {
                savedGrid.innerHTML = '<p style="text-align:center;padding:20px;color:var(--mauve)">extract designs first!</p>';
            } else {
                savedGrid.innerHTML = savedDesigns.map(d => makeCard(d, false)).join('');
            }
            
            classicGrid.innerHTML = classicColors.map(d => makeCard(d, false)).join('');
        }

        function makeCard(design, showDelete) {
            const style = design.type === 'color' 
                ? `background: ${design.color}` 
                : `background-image: url('${design.imageData}'); background-size: cover`;
            
            return `
                <div class="design-card" draggable="true" data-design='${JSON.stringify(design)}'>
                    ${showDelete ? `<button class="delete-design" onclick='deleteDesign("${design.id}")'>×</button>` : ''}
                    <div class="design-preview" style="${style}"></div>
                    <div class="design-name">${design.name}</div>
                </div>
            `;
        }

        function deleteDesign(id) {
            if (confirm('delete this design?')) {
                savedDesigns = savedDesigns.filter(d => d.id !== id);
                localStorage.setItem('tipsySaved', JSON.stringify(savedDesigns));
                updateCounts();
                populateLibrary();
            }
        }

        // Drag and drop
        let draggedDesign = null;

        document.addEventListener('dragstart', function(e) {
            if (e.target.classList.contains('design-card')) {
                draggedDesign = JSON.parse(e.target.getAttribute('data-design'));
                e.target.classList.add('dragging');
            }
        });

        document.addEventListener('dragend', function(e) {
            if (e.target.classList.contains('design-card')) {
                e.target.classList.remove('dragging');
            }
        });

        document.querySelectorAll('.nail-slot').forEach(slot => {
            slot.addEventListener('dragover', function(e) {
                e.preventDefault();
                this
